#!/usr/bin/env python3

import threading
import time
import subprocess
import datetime
import os

class RosbagRecordThread(threading.Thread):
    def __init__(self, rosbagname, topicstorecord, recordtime ):

        """Thread to record a rosbag. 
        This thread lauch a rosbag command line to record topics in input

        Input:
        ------
        rosbagname : str without .bag : to store data
        topicstorecord : list of str with the name of topics to record
        recordtime : duration of the record
        """
        threading.Thread.__init__(self)
        date = datetime.datetime.now()
        filename = "{}{}-{}-{}-{}-{}-{}.bag".format(rosbagname,date.year,date.month,date.day,date.hour,date.minute,date.second)

        #Definition of the rosbag command line
        self.rosbag_cmd = ["rosbag","record","-O", os.getcwd()+"/"+filename, "--duration={}s".format(recordtime)] + topicstorecord 
        print(self.rosbag_cmd)

    def run(self):
        #Launch the rosbag command
        subprocess.call(self.rosbag_cmd) 

if __name__=="__main__":
    thrd = RosbagRecordThread('test', ["/imu/imu", "/imu/magn"], 30)
    print("start thread")
    thrd.start()
    thrd.join()































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































